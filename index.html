<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>ğŸ‘€ã¿ã¦ã¤ãã‚‹ã‚·ãƒ¼ãƒˆğŸš—</title>
<style>
/* ä»¥å‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶™æ‰¿ */
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { font-family: sans-serif; background: #f0f2f5; color: #333; max-width: 960px; margin: 0 auto; }
.header { background: linear-gradient(135deg, #4CAF50, #2E7D32); color: white; text-align: center; padding: 1.2rem; }
.nav-container { width: 100%; overflow-x: auto; background: white; padding: 10px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.nav-scroll { display: inline-flex; gap: 8px; }
.nav-btn { flex-shrink: 0; padding: 12px 15px; font-size: 1.1rem; font-weight: bold; border: none; border-radius: 12px; background: #e1f5fe; color: #0288d1; min-width: 110px; }
.nav-btn.active { background: #ff9800; color: white; }
.main-content { padding: 15px; }
.step-card { background: white; border-radius: 18px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
.step-title { font-size: 1.4rem; color: #1565C0; margin-bottom: 15px; font-weight: bold; }
.photo-list { display: flex; flex-direction: column; gap: 15px; margin-bottom: 15px; }
.photo-container { position: relative; background: #000; border-radius: 12px; overflow: hidden; line-height: 0; }
.step-image { width: 100%; height: auto; cursor: pointer; }

/* ã‚¢ãƒ«ãƒãƒ ç”¨ã®è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
.album-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 20px; }
.album-item { position: relative; border-radius: 10px; overflow: hidden; background: #eee; aspect-ratio: 1; }
.album-item img { width: 100%; height: 100%; object-fit: cover; }
.add-photo-btn { background: #4caf50; color: white; border: none; padding: 15px; border-radius: 10px; width: 100%; font-size: 1.2rem; font-weight: bold; cursor: pointer; }
.del-btn { position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 50%; width: 25px; height: 25px; }

/* æ‹¡å¤§ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆä»¥å‰ã¨åŒã˜ï¼‰ */
.overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000; z-index: 10000; display: none; align-items: center; justify-content: center; touch-action: none; }
.overlay.active { display: flex; }
.overlay-image { max-width: 100%; max-height: 100%; object-fit: contain; transition: transform 0.1s ease-out; }
.close-btn { position: fixed; top: 15px; right: 15px; width: 65px; height: 65px; border-radius: 50%; background: white; border: none; font-weight: bold; z-index: 10001; }
</style>
</head>
<body>

<header class="header">
  <h1>ğŸ‘€ã¿ã¦ã¤ãã‚‹ã‚·ãƒ¼ãƒˆğŸš—</h1>
  <p>ã˜ã¶ã‚“ã®å·¥ä½œã‚’ã‚¢ãƒ«ãƒãƒ ã«ã®ã“ãã†ï¼</p>
</header>

<div class="nav-container">
  <div class="nav-scroll" id="navButtons"></div>
</div>

<main class="main-content" id="content"></main>

<script>
const steps = [
  { nav: "â‘  ã§ã‚“ã¡", title: "â‘  ã§ã‚“ã¡ã‚’ã„ã‚Œã‚‹", img1: "images/battery_box.jpg", img2: "", ok: "é›»æ± ã®å‘ãOKï¼", note: "ï¼‹ã¨ï¼ã‚’ã‚ˆãè¦‹ã¦ã„ã‚Œã‚ˆã†ã€‚" },
  { nav: "â‘¡ ã›ã‚“", title: "â‘¡ ã›ã‚“ã‚’ã¤ãªã", img1: "images/wire_magnet.jpg", img2: "", ok: "ç·šãŒã¤ãªãŒã£ãŸï¼", note: "ç£çŸ³ãŒã—ã£ã‹ã‚Šä»˜ã„ã¦ã„ã‚‹ã‹ç¢ºèªã€‚" },
  { nav: "â‘¢ ã‚¹ã‚¤ãƒƒãƒ", title: "â‘¢ ã‚¹ã‚¤ãƒƒãƒ", img1: "images/switch_complete.jpg", img2: "", ok: "åˆ‡ã‚Šæ›¿ã‚ã‚‹ï¼", note: "å·¦å³ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­ã€‚" },
  { nav: "â‘£ ã¾ã‚ã‚‹", title: "â‘£ ãƒ¢ãƒ¼ã‚¿ãƒ¼", img1: "images/motor_test.jpg", img2: "", ok: "å›ã‚Œã° OKï¼", note: "æ³¨æ„ã—ã¦è¦‹ã¦ã­ã€‚" },
  { nav: "â‘¤ ã¿ãŸã‚", title: "â‘¤ å®Œæˆã‚¤ãƒ¡ãƒ¼ã‚¸", img1: "images/car_complete.jpg", img2: "images/3ami.gif", ok: "ã„ã„ã‹ã‚“ã˜ï¼", note: "å‘ãã‚’ã‹ãã«ã‚“ã€‚" },
  { nav: "â‘¥ ã‹ã‚“ã›ã„", title: "â‘¥ ã‚„ã£ãŸã­ï¼", img1: "images/complete.jpg", img2: "", ok: "å¤§æˆåŠŸï¼", note: "ã•ã‚èµ°ã‚‰ã›ã‚ˆã†ã€‚" },
  { nav: "ğŸ“¸ã‚¢ãƒ«ãƒãƒ ", title: "ğŸ“¸ ãŠã‚‚ã„ã§ã‚¢ãƒ«ãƒãƒ ", isAlbum: true } // ã‚¢ãƒ«ãƒãƒ æ©Ÿèƒ½
];

let currentStep = 0;
const navButtons = document.getElementById('navButtons');
const content = document.getElementById('content');

function render() {
  navButtons.innerHTML = '';
  steps.forEach((s, i) => {
    const b = document.createElement('button');
    b.className = `nav-btn ${i === currentStep ? 'active' : ''}`;
    b.textContent = s.nav;
    b.onclick = () => { currentStep = i; render(); };
    navButtons.appendChild(b);
  });

  const s = steps[currentStep];

  if (s.isAlbum) {
    // ã‚¢ãƒ«ãƒãƒ ç”»é¢ã®è¡¨ç¤º
    renderAlbumView(s);
  } else {
    // é€šå¸¸ã®å·¥ç¨‹ç”»é¢ã®è¡¨ç¤º
    renderStepView(s);
  }
}

function renderStepView(s) {
  let photoHtml = `<div class="photo-container" onclick="openOverlay('${s.img1}')"><img src="${s.img1}" class="step-image"></div>`;
  if (s.img2) photoHtml += `<div class="photo-container" onclick="openOverlay('${s.img2}')"><img src="${s.img2}" class="step-image"></div>`;

  content.innerHTML = `
    <div class="step-card">
      <div class="step-title">${s.title}</div>
      <div class="photo-list">${photoHtml}</div>
      <div style="background:#e8f5e9; padding:10px; border-radius:10px; margin-bottom:10px;"><b>${s.ok}</b></div>
      <div style="background:#fff3e0; padding:10px; border-radius:10px;">${s.note}</div>
    </div>`;
}

function renderAlbumView(s) {
  const savedPhotos = JSON.parse(localStorage.getItem('myAlbum') || '[]');
  
  let albumHtml = savedPhotos.map((dataUrl, index) => `
    <div class="album-item">
      <img src="${dataUrl}" onclick="openOverlay('${dataUrl}')">
      <button class="del-btn" onclick="deletePhoto(${index})">Ã—</button>
    </div>
  `).join('');

  content.innerHTML = `
    <div class="step-card">
      <div class="step-title">${s.title}</div>
      <p style="margin-bottom:15px;">ã˜ã¶ã‚“ã®å·¥ä½œã‚’å†™çœŸã«ã¨ã£ã¦ã®ã“ã›ã‚‹ã‚ˆï¼</p>
      <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none;" onchange="savePhoto(event)">
      <button class="add-photo-btn" onclick="document.getElementById('cameraInput').click()">ğŸ“· å†™çœŸã‚’ã¨ã‚‹ãƒ»ãˆã‚‰ã¶</button>
      <div class="album-grid">${albumHtml}</div>
    </div>`;
}

// å†™çœŸã‚’ä¿å­˜ã™ã‚‹å‡¦ç†
function savePhoto(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const savedPhotos = JSON.parse(localStorage.getItem('myAlbum') || '[]');
    savedPhotos.push(e.target.result); // Base64å½¢å¼ã§ä¿å­˜
    localStorage.setItem('myAlbum', JSON.stringify(savedPhotos));
    render(); // å†æç”»
  };
  reader.readAsDataURL(file);
}

// å†™çœŸã‚’å‰Šé™¤ã™ã‚‹å‡¦ç†
function deletePhoto(index) {
  if (!confirm('ã“ã®å†™çœŸã‚’ã‘ã—ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ')) return;
  const savedPhotos = JSON.parse(localStorage.getItem('myAlbum') || '[]');
  savedPhotos.splice(index, 1);
  localStorage.setItem('myAlbum', JSON.stringify(savedPhotos));
  render();
}

// --- æ‹¡å¤§ãƒ»å›è»¢åˆ¶å¾¡ï¼ˆä»¥å‰ã¨åŒã˜ï¼‰ ---
let scale = 1, posX = 0, posY = 0, pointers = {};
async function openOverlay(src) {
  try {
    if (document.documentElement.requestFullscreen) {
      await document.documentElement.requestFullscreen();
      if (screen.orientation && screen.orientation.lock) await screen.orientation.lock('landscape').catch(()=>{});
    }
  } catch (err) {}
  const ov = document.createElement('div');
  ov.className = 'overlay'; ov.id = 'imgOverlay';
  const img = document.createElement('img');
  img.className = 'overlay-image'; img.src = src;
  const btn = document.createElement('button');
  btn.className = 'close-btn'; btn.innerHTML = 'Ã—<br>ã¨ã˜ã‚‹';
  btn.onclick = closeOverlay;
  ov.appendChild(img); ov.appendChild(btn);
  document.body.appendChild(ov);
  setTimeout(() => ov.classList.add('active'), 10);
  document.body.style.overflow = 'hidden';
}

function closeOverlay() {
  const ov = document.getElementById('imgOverlay');
  if (!ov) return;
  if (screen.orientation && screen.orientation.unlock) screen.orientation.unlock();
  if (document.exitFullscreen && document.fullscreenElement) document.exitFullscreen().catch(()=>{});
  ov.classList.remove('active');
  setTimeout(() => { if (ov.parentNode) ov.parentNode.removeChild(ov); document.body.style.overflow = ''; }, 300);
}

window.addEventListener('DOMContentLoaded', render);
</script>
</body>
</html>
