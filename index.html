<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>ğŸ‘€ã¿ã¦ã¤ãã‚‹ã‚·ãƒ¼ãƒˆğŸš—</title>
<style>
/* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ« */
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { font-family: sans-serif; background: #f0f2f5; color: #333; max-width: 960px; margin: 0 auto; }
.header { background: linear-gradient(135deg, #4CAF50, #2E7D32); color: white; text-align: center; padding: 1.2rem; }
.nav-container { width: 100%; overflow-x: auto; background: white; padding: 10px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.nav-scroll { display: inline-flex; gap: 8px; }
.nav-btn { flex-shrink: 0; padding: 12px 15px; font-size: 1.1rem; font-weight: bold; border: none; border-radius: 12px; background: #e1f5fe; color: #0288d1; min-width: 110px; }
.nav-btn.active { background: #ff9800; color: white; }
.main-content { padding: 15px; }
.step-card { background: white; border-radius: 18px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
.step-title { font-size: 1.4rem; color: #1565C0; margin-bottom: 15px; font-weight: bold; }
.photo-list { display: flex; flex-direction: column; gap: 15px; margin-bottom: 15px; }
.photo-container { position: relative; background: #000; border-radius: 12px; overflow: hidden; line-height: 0; }
.step-image { width: 100%; height: auto; cursor: pointer; }

/* ã‚¢ãƒ«ãƒãƒ ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */
.album-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
.album-item { position: relative; border-radius: 12px; overflow: hidden; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
.album-img-wrapper { position: relative; aspect-ratio: 1; overflow: hidden; background: #eee; }
.album-item img { width: 100%; height: 100%; object-fit: cover; }
.album-info { padding: 8px; font-size: 0.9rem; }
.album-name { font-weight: bold; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.album-date { font-size: 0.75rem; color: #777; margin-top: 2px; }

.add-photo-btn { background: #4caf50; color: white; border: none; padding: 15px; border-radius: 10px; width: 100%; font-size: 1.2rem; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
.del-btn { position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.6); color: white; border: none; border-radius: 50%; width: 28px; height: 28px; font-size: 18px; z-index: 10; cursor: pointer; }

/* æ‹¡å¤§ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
.overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000; z-index: 10000; display: none; align-items: center; justify-content: center; touch-action: none; }
.overlay.active { display: flex; }
.overlay-image { max-width: 100%; max-height: 100%; object-fit: contain; }
.close-btn { position: fixed; top: 15px; right: 15px; width: 65px; height: 65px; border-radius: 50%; background: white; border: none; font-weight: bold; z-index: 10001; }
</style>
</head>
<body>

<header class="header">
  <h1>ğŸ‘€ã¿ã¦ã¤ãã‚‹ã‚·ãƒ¼ãƒˆğŸš—</h1>
  <p>ã¿ã‚“ãªã®å·¥ä½œã‚’ã‚¢ãƒ«ãƒãƒ ã«ã®ã“ãã†ï¼</p>
</header>

<div class="nav-container">
  <div class="nav-scroll" id="navButtons"></div>
</div>

<main class="main-content" id="content"></main>

<script>
const steps = [
  { nav: "â‘  ã§ã‚“ã¡", title: "â‘  ã§ã‚“ã¡ã‚’ã„ã‚Œã‚‹", img1: "images/battery_box.jpg", img2: "", ok: "é›»æ± ã®å‘ãOKï¼", note: "ï¼‹ã¨ï¼ã‚’ã‚ˆãè¦‹ã¦ã„ã‚Œã‚ˆã†ã€‚" },
  { nav: "â‘¡ ã›ã‚“", title: "â‘¡ ã›ã‚“ã‚’ã¤ãªã", img1: "images/wire_magnet.jpg", img2: "images/wire_zoom.jpg", ok: "ç·šãŒã¤ãªãŒã£ãŸï¼", note: "ç£çŸ³ãŒã—ã£ã‹ã‚Šä»˜ã„ã¦ã„ã‚‹ã‹ç¢ºèªã€‚" },
  { nav: "â‘¢ ã‚¹ã‚¤ãƒƒãƒ", title: "â‘¢ ã‚¹ã‚¤ãƒƒãƒ", img1: "images/switch_complete.jpg", img2: "", ok: "åˆ‡ã‚Šæ›¿ã‚ã‚‹ï¼", note: "å·¦å³ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­ã€‚" },
  { nav: "â‘£ ã¾ã‚ã‚‹", title: "â‘£ ãƒ¢ãƒ¼ã‚¿ãƒ¼", img1: "images/motor_test.jpg", img2: "", ok: "å›ã‚Œã° OKï¼", note: "æ³¨æ„ã—ã¦è¦‹ã¦ã­ã€‚" },
  { nav: "â‘¤ ã¿ãŸã‚", title: "â‘¤ å®Œæˆã‚¤ãƒ¡ãƒ¼ã‚¸", img1: "images/car_complete.jpg", img2: "images/3ami.gif", ok: "ã„ã„ã‹ã‚“ã˜ï¼", note: "å‘ãã‚’ã‹ãã«ã‚“ã€‚" },
  { nav: "â‘¥ ã‹ã‚“ã›ã„", title: "â‘¥ ã‚„ã£ãŸã­ï¼", img1: "images/complete.jpg", img2: "", ok: "å¤§æˆåŠŸï¼", note: "ã•ã‚èµ°ã‚‰ã›ã‚ˆã†ã€‚" },
  { nav: "ğŸ“¸ã‚¢ãƒ«ãƒãƒ ", title: "ğŸ“¸ ãŠã‚‚ã„ã§ã‚¢ãƒ«ãƒãƒ ", isAlbum: true }
];

let currentStep = 0;
const navButtons = document.getElementById('navButtons');
const content = document.getElementById('content');

function render() {
  navButtons.innerHTML = '';
  steps.forEach((s, i) => {
    const b = document.createElement('button');
    b.className = `nav-btn ${i === currentStep ? 'active' : ''}`;
    b.textContent = s.nav;
    b.onclick = () => { currentStep = i; render(); };
    navButtons.appendChild(b);
  });

  const s = steps[currentStep];
  if (s.isAlbum) {
    renderAlbumView(s);
  } else {
    renderStepView(s);
  }
}

function renderStepView(s) {
  let photoHtml = `<div class="photo-container" onclick="openOverlay('${s.img1}')"><img src="${s.img1}" class="step-image"></div>`;
  if (s.img2) photoHtml += `<div class="photo-container" onclick="openOverlay('${s.img2}')"><img src="${s.img2}" class="step-image"></div>`;

  content.innerHTML = `
    <div class="step-card">
      <div class="step-title">${s.title}</div>
      <div class="photo-list">${photoHtml}</div>
      <div style="background:#e8f5e9; padding:10px; border-radius:10px; margin-bottom:10px;"><b>${s.ok}</b></div>
      <div style="background:#fff3e0; padding:10px; border-radius:10px;">${s.note}</div>
    </div>`;
}

function renderAlbumView(s) {
  let savedPhotos = JSON.parse(localStorage.getItem('myAlbumV2') || '[]');
  
  // æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆï¼ˆæ–°ã—ã„é †ï¼‰
  savedPhotos.sort((a, b) => b.timestamp - a.timestamp);

  let albumHtml = savedPhotos.map((item, index) => {
    const dateStr = new Date(item.timestamp).toLocaleString('ja-JP', {month:'short', day:'numeric', hour:'2-digit', minute:'2-digit'});
    return `
    <div class="album-item">
      <button class="del-btn" onclick="deletePhoto(${item.timestamp})">Ã—</button>
      <div class="album-img-wrapper">
        <img src="${item.dataUrl}" onclick="openOverlay('${item.dataUrl}')">
      </div>
      <div class="album-info">
        <span class="album-name">${item.name || 'ãªã¾ãˆãªã—'}</span>
        <span class="album-date">${dateStr}</span>
      </div>
    </div>
  `}).join('');

  content.innerHTML = `
    <div class="step-card">
      <div class="step-title">${s.title}</div>
      <p style="margin-bottom:15px;">å·¥ä½œã«ã€Œãªã¾ãˆã€ã‚’ã¤ã‘ã¦ã®ã“ãã†ï¼</p>
      <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none;" onchange="savePhoto(event)">
      <button class="add-photo-btn" onclick="document.getElementById('cameraInput').click()">ğŸ“· å†™çœŸã‚’ã¨ã‚‹ãƒ»ãˆã‚‰ã¶</button>
      <div class="album-grid">${albumHtml}</div>
    </div>`;
}

function savePhoto(event) {
  const file = event.target.files[0];
  if (!file) return;

  const workName = prompt("å·¥ä½œã®ã€Œãªã¾ãˆã€ã‚’æ•™ãˆã¦ã­ï¼", "ã˜ã¶ã‚“ã®å·¥ä½œ");
  if (workName === null) return; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸå ´åˆ

  const reader = new FileReader();
  reader.onload = function(e) {
    const savedPhotos = JSON.parse(localStorage.getItem('myAlbumV2') || '[]');
    const newItem = {
      dataUrl: e.target.result,
      name: workName,
      timestamp: Date.now() // ã‚½ãƒ¼ãƒˆç”¨ã®æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿
    };
    savedPhotos.push(newItem);
    localStorage.setItem('myAlbumV2', JSON.stringify(savedPhotos));
    render();
  };
  reader.readAsDataURL(file);
}

function deletePhoto(timestamp) {
  if (!confirm('ã“ã®å†™çœŸã‚’ã‘ã—ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ')) return;
  let savedPhotos = JSON.parse(localStorage.getItem('myAlbumV2') || '[]');
  savedPhotos = savedPhotos.filter(item => item.timestamp !== timestamp);
  localStorage.setItem('myAlbumV2', JSON.stringify(savedPhotos));
  render();
}

// --- æ‹¡å¤§åˆ¶å¾¡ï¼ˆåŸºæœ¬æ©Ÿèƒ½ç¶­æŒï¼‰ ---
async function openOverlay(src) {
  const ov = document.createElement('div');
  ov.className = 'overlay'; ov.id = 'imgOverlay';
  ov.innerHTML = `<img src="${src}" class="overlay-image"><button class="close-btn" onclick="closeOverlay()">Ã—<br>ã¨ã˜ã‚‹</button>`;
  document.body.appendChild(ov);
  setTimeout(() => ov.classList.add('active'), 10);
  document.body.style.overflow = 'hidden';
}

function closeOverlay() {
  const ov = document.getElementById('imgOverlay');
  if (!ov) return;
  ov.classList.remove('active');
  setTimeout(() => { ov.remove(); document.body.style.overflow = ''; }, 300);
}

window.addEventListener('DOMContentLoaded', render);
</script>
</body>
</html>
